{% extends 'base/base.html' %}
{% load auth_extra %}
{% load i18n %}
{% block breadcrumb %}
  <li class="breadcrumb-item">
    <a href="{% url 'user:condominium_list' %}">Condominios</a>
  </li>
  <li class="breadcrumb-item active">Detalles</li>
{% endblock %}
{% block content %}
  <div class="card">
    <div class="card-header">
      Fecha: {{ object.date }}<br>
      Tasa del Dólar: {{ object.rate }} Bs<br>
      Monto del Condominio: {{ object.amount }} usd<br>
      {% if request.user|has_group:'Líder de Comunidad' %}
        Total Recaudado: {{ total_sum.0 }} bs | {{ total_sum.1 }} usd
      {% endif %}
    </div>

    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered display dataTable" style="width:100%;">
          <thead>
            <tr>
              <th>Lider de Calle</th>
              <th>Recaudado</th>
            </tr>
          </thead>
          <tbody>
            {% for key, value in amount_street_leaders.items %}
              <tr>
                <td> {{ key }} </td>
                <td> {{ value.0 }} Bs |  {{ value.1 }} usd </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <br><br>
      <div class="table-responsive">
        <form id="form_activate" method="post">
        {% csrf_token %}
        <table class="table table-striped table-hover table-bordered display dataTable" id="table" style="width:100%;">
          <thead>
            <tr>
              <th>Pagador</th>
              <th>Departamento</th>
              <th>Monto del Condominio</th>
              <th>¿Pagado?</th>
              {% if request.user|has_group:'Líder de Comunidad' %}
                <th>Líder de Calle</th>
              {% endif %}
            </tr>
          </thead>
          <tbody>
            {% for payment in object.payment_set.all %}
              {% if object.user == request.user %}
                <tr>
                  <td> {{ payment.payer }} </td>
                  <td> {{ payment.department }}</td>
                  <td> {{ payment.amount }} Bs</td>
                  {% if payment.paid %}
                    <td> <i class="far fa-thumbs-up fa-3x text-success" title="Pagado" aria-hidden="true"></i> </td>
                  {% else %}
                    <td> <i class="far fa-thumbs-down fa-3x text-danger" title="No Pagado" aria-hidden="true"></i> </td>
                  {% endif %}
                  <td> {{ payment.user }} </td>
                </tr>
              {% elif payment.user == request.user %}
                <tr>
                  <td> {{ payment.payer }} </td>
                  <td> {{ payment.department }}</td>
                  <td> {{ payment.amount }} Bs</td>
                  {% if payment.paid %}
                    <td>
                      <i class="far fa-thumbs-up fa-3x text-success" title="Pagado" aria-hidden="true"></i>
                      <input type='checkbox' id='user-{{ payment.id }}' value='{{ payment.id }}' name='deactivate' onclick='$("#form_activate").submit();'/>
                    </td>
                  {% else %}
                    <td>
                      <i class="far fa-thumbs-down fa-3x text-danger" title="No Pagado" aria-hidden="true"></i>
                      <input type='checkbox' id='user-{{ payment.id }}' value='{{ payment.id }}' name='activate' onclick='$("#form_activate").submit();'/>
                    </td>
                  {% endif %}
                </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
        </form>
      </div>
    </div>
  </div>
{% endblock %}